var root,__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Events=function(){function t(){}return t.prototype.handlers={},t.prototype.on=function(t,e){return null==this.handlers[t]&&(this.handlers[t]=[]),this.handlers[t].push(e),this},t.prototype.off=function(t,e){return null!=this.handlers[t]&&(this.handlers[t]=this.handlers[t].filter(function(t){return t===!e})),this},t.prototype.trigger=function(){var t,e,n,o,i,r;for(n=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],r=this.handlers[n]||[],o=0,i=r.length;i>o;o++)e=r[o],e.apply(null,t);return this},t.prototype.clear=function(){return this.handlers={}},t}();var root,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Utils=function(){function t(){}return t.parentNodes=function(t,e){var n,o,i,r,s;if(e instanceof Array){for(s=[],i=0,r=e.length;r>i;i++)n=e[i],s.push(this.parentNodes(t,n));return s}for(o=[];e&&e!==t;)o.push(e),e=e.parentNode;return o},t.flatten=function(t){return 0===t.length?[]:t.reduce(function(t,e){return t.concat(e)})},t.uniqueNodes=function(t){var e,n,o,i,r,s;for(n=[],o=0,r=t.length;r>o;o++)e=t[o],e._visited||n.push(e),e._visited=!0;for(i=0,s=n.length;s>i;i++)e=n[i],e._visited=!1;return n},t.domNodes=function(t){return t.filter(function(t){return 1===t.nodeType})},t}(),root.Editor=function(t){function e(t){this.opts=t||{},this.node=t.node,this.originalClass=this.node.className,this.originalContent=this.node.innerHTML}return __extends(e,t),e.pluginsRegistry={},e.register=function(){var t,e,n,o,i;for(e=1<=arguments.length?__slice.call(arguments,0):[],i=[],n=0,o=e.length;o>n;n++)t=e[n],this.pluginsRegistry[t.pluginName]=t,i.push(t.extendEditor(this));return i},e.prototype.activate=function(t){var n;return this.node.setAttribute("contenteditable",!0),this.plugins=function(){var t,o,i,r;for(i=this.opts.plugins,r=[],t=0,o=i.length;o>t;t++)n=i[t],r.push(new e.pluginsRegistry[n](this));return r}.call(this),this.initDOMEvents(),null!=t?t(this):void 0},e.prototype.deactivate=function(t){var e,n,o,i;for(this.node.setAttribute("contenteditable",!1),i=this.plugins,n=0,o=i.length;o>n;n++)e=i[n],e.deactivate();return this.deactivateDOMEvents(),this.clear(),null!=t?t(this):void 0},e.prototype.hasChanged=function(){return this.node.innerHTML!==this.originalContent},e.prototype.revert=function(){return this.node.innerHTML=this.originalContent},e.prototype.exec=function(){var t,e;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],t.length>0?document.execCommand.apply(document,[e,!1].concat(__slice.call(t))):document.execCommand(e,!1,this.getSelection()),this.checkSelection()},e.prototype.initDOMEvents=function(){return this.node.addEventListener("keydown",this.onKeydown.bind(this)),this.node.addEventListener("keyup",this.onKeyup.bind(this)),this.node.addEventListener("mousedown",this.onMousedown.bind(this)),this.node.addEventListener("mouseup",this.onMouseup.bind(this))},e.prototype.deactivateDOMEvents=function(){return this.node.removeEventListener("keydown",this.onKeydown),this.node.removeEventListener("keyup",this.onKeyup),this.node.removeEventListener("mousedown",this.onMousedown),this.node.removeEventListener("mouseup",this.onMouseup)},e.prototype.onKeydown=function(t){return this.checkSelection(),this.trigger("keydown",t)},e.prototype.onKeyup=function(){return this.checkSelection()},e.prototype.onMousedown=function(){return this.checkSelection()},e.prototype.onMouseup=function(){return this.checkSelection()},e.prototype.getSelection=function(){return rangy.getSelection()},e.prototype.checkSelection=function(){var t,e,n;return n=this.getSelection(),e=null,t=[],n.rangeCount&&(e=n.getRangeAt(0),e.collapsed?(e.startContainer||e.endContainer)&&(t=[e.startContainer||e.endContainer]):t=e.getNodes(),t=Utils.uniqueNodes(Utils.flatten(Utils.parentNodes(this.node,t)))),this.trigger("selection:change",n,e,t,n.toHtml())},e}(Events);