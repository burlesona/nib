var root,__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Events=function(){function t(){this.handlers={}}return t.prototype.on=function(t,e){return null==this.handlers[t]&&(this.handlers[t]=[]),this.handlers[t].push(e),this},t.prototype.off=function(t,e){return null!=this.handlers[t]&&(this.handlers[t]=this.handlers[t].filter(function(t){return t===!e})),this},t.prototype.trigger=function(){var t,e,n,o,r,i;for(n=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],i=this.handlers[n]||[],o=0,r=i.length;r>o;o++)e=i[o],e.apply(null,[this].concat(__slice.call(t)));return this},t.prototype.clear=function(){return this.handlers={}},t}();var root;root="undefined"!=typeof exports&&null!==exports?exports:this,root.SelectionHandler=function(){function t(){this.selection=rangy.getSelection(),this.baseNode=this.selection.nativeSelection.baseNode,this.baseOffset=this.selection.nativeSelection.baseOffset,this.extentNode=this.selection.nativeSelection.extentNode,this.extentOffset=this.selection.nativeSelection.extentOffset,this.backwards=this.selection.isBackwards()}return t.prototype.restoreSelection=function(){var t,e;return e=rangy.createRange(),e.setStart(this.baseNode,this.baseOffset),this.selection.removeAllRanges(),this.backwards?(e.setEnd(this.baseNode,this.baseOffset),t=rangy.createRange(),t.setStart(this.extentNode,this.extentOffset),t.setEnd(this.extentNode,this.extentOffset),this.selection.addRange(e),this.selection.addRange(t,!0),t.detach()):(e.setEnd(this.extentNode,this.extentOffset),this.selection.setSingleRange(e)),e.detach()},t}();var root;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Utils=function(){function t(){}return t.parentNodes=function(t,e){var n,o,r,i,s;if(e instanceof Array){for(s=[],r=0,i=e.length;i>r;r++)n=e[r],s.push(this.parentNodes(t,n));return s}for(o=[];e&&e!==t;)o.push(e),e=e.parentNode;return o},t.flatten=function(t){return 0===t.length?[]:t.reduce(function(t,e){return t.concat(e)})},t.uniqueNodes=function(t){var e,n,o,r,i,s;for(n=[],o=0,i=t.length;i>o;o++)e=t[o],e._visited||n.push(e),e._visited=!0;for(r=0,s=n.length;s>r;r++)e=n[r],e._visited=!1;return n},t.domNodes=function(t){return t.filter(function(t){return 1===t.nodeType})},t}();var root,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Editor=function(t){function e(t){this.opts=t||{},this.node=t.node,this.originalClass=this.node.className,this.originalContent=this.node.innerHTML,e.__super__.constructor.call(this,t)}return __extends(e,t),e.pluginsRegistry={},e.register=function(){var t,e,n,o,r;for(e=1<=arguments.length?__slice.call(arguments,0):[],r=[],n=0,o=e.length;o>n;n++)t=e[n],this.pluginsRegistry[t.pluginName]=t,r.push(t.extendEditor(this));return r},e.prototype.activate=function(){var t;return this.node.setAttribute("contenteditable",!0),null!=this.opts.plugins&&(this.plugins=function(){var n,o,r,i;for(r=this.opts.plugins,i=[],n=0,o=r.length;o>n;n++)t=r[n],i.push(new e.pluginsRegistry[t](this));return i}.call(this)),this.initDOMEvents(),this.trigger("editor:on")},e.prototype.deactivate=function(){var t,e,n,o;if(this.node.setAttribute("contenteditable",!1),this.plugins)for(o=this.plugins,e=0,n=o.length;n>e;e++)t=o[e],t.deactivate();return this.deactivateDOMEvents(),this.clear(),this.trigger("editor:off")},e.prototype.hasChanged=function(){return this.node.innerHTML!==this.originalContent},e.prototype.revert=function(){return this.node.innerHTML=this.originalContent},e.prototype.exec=function(){var t,e;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],t.length>0?document.execCommand.apply(document,[e,!1].concat(__slice.call(t))):document.execCommand(e,!1,this.getSelection()),this.checkSelection()},e.prototype.initDOMEvents=function(){return this.node.addEventListener("keydown",this.onKeydown.bind(this)),this.node.addEventListener("keyup",this.onKeyup.bind(this)),this.node.addEventListener("mousedown",this.onMousedown.bind(this)),this.node.addEventListener("mouseup",this.onMouseup.bind(this))},e.prototype.deactivateDOMEvents=function(){return this.node.removeEventListener("keydown",this.onKeydown),this.node.removeEventListener("keyup",this.onKeyup),this.node.removeEventListener("mousedown",this.onMousedown),this.node.removeEventListener("mouseup",this.onMouseup)},e.prototype.onKeydown=function(t){return this.checkSelection(),this.trigger("keydown",t)},e.prototype.onKeyup=function(){return this.checkSelection()},e.prototype.onMousedown=function(){return this.checkSelection()},e.prototype.onMouseup=function(){return this.checkSelection()},e.prototype.getSelection=function(){return rangy.getSelection()},e.prototype.getSelectedNodes=function(){var t,e,n;return n=this.getSelection(),t=[],n.rangeCount&&(e=n.getRangeAt(0),e.collapsed?(e.startContainer||e.endContainer)&&(t=[e.startContainer||e.endContainer]):t=e.getNodes(),t=Utils.uniqueNodes(Utils.flatten(Utils.parentNodes(this.node,t))),e.detach()),n.detach(),t},e.prototype.checkSelection=function(){var t,e,n;return t=this.getSelectedNodes(),n=this.getSelection(),n.rangeCount&&(e=n.getRangeAt(0)),this.trigger("selection:change",n,e,t,n.toHtml()),this.detach(n,e)},e.prototype.detach=function(){var t,e,n,o,r;for(t=1<=arguments.length?__slice.call(arguments,0):[],r=[],n=0,o=t.length;o>n;n++)e=t[n],e&&r.push(e.detach());return r},e.prototype.saveSelection=function(){return new SelectionHandler},e.prototype.restoreSelection=function(t){return t.restoreSelection(),this.checkSelection()},e.prototype.wrap=function(t){var e,n,o,r;return r=this.getSelection(),o=r.getRangeAt(0),n=document.createElement(t),o.canSurroundContents()&&o.surroundContents(n),e=rangy.createRange(),e.selectNodeContents(n),r.setSingleRange(e),this.checkSelection(),this.detach(o),n},e.prototype.lookForTags=function(t,e){var n,o,r,i;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],1===n.nodeType&&n.tagName.toLowerCase()===t&&o.push(n);return o},e.prototype.lookForTag=function(t,e){var n,o,r;for(o=0,r=e.length;r>o;o++)if(n=e[o],1===n.nodeType&&n.tagName.toLowerCase()===t)return n},e.prototype.wrapped=function(t){var e;return e=this.getSelectedNodes(),this.lookForTag(t,e)},e.prototype.unwrap=function(t){var e,n,o,r,i,s,a;for(o=this.getSelectedNodes(),i=this.lookForTags(t,o),r=this.saveSelection(),s=0,a=i.length;a>s;s++){for(n=i[s];e=n.firstChild;)n.parentNode.insertBefore(e,n);n.remove()}return this.restoreSelection(r),this.checkSelection()},e}(Events);