var root,__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Events=function(){function t(){}return t.prototype.handlers={},t.prototype.on=function(t,e){return null==this.handlers[t]&&(this.handlers[t]=[]),this.handlers[t].push(e),this},t.prototype.off=function(t,e){return null!=this.handlers[t]&&(this.handlers[t]=this.handlers[t].filter(function(t){return t===!e})),this},t.prototype.trigger=function(){var t,e,n,r,o,i;for(n=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],i=this.handlers[n]||[],r=0,o=i.length;o>r;r++)e=i[r],e.apply(null,t);return this},t}();var root,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,root.Utils=function(){function t(){}return t.parentNodes=function(t,e){var n,r,o,i,s;if(e instanceof Array){for(s=[],o=0,i=e.length;i>o;o++)n=e[o],s.push(this.parentNodes(t,n));return s}for(r=[];e&&e!==t;)r.push(e),e=e.parentNode;return r},t.flatten=function(t){return 0===t.length?[]:t.reduce(function(t,e){return t.concat(e)})},t.uniqueNodes=function(t){var e,n,r,o,i,s;for(n=[],r=0,i=t.length;i>r;r++)e=t[r],e._visited||n.push(e),e._visited=!0;for(o=0,s=n.length;s>o;o++)e=n[o],e._visited=!1;return n},t.domNodes=function(t){return t.filter(function(t){return 1===t.nodeType})},t}(),root.Editor=function(t){function e(t){this.opts=t||{},this.node=t.node,this.originalClass=this.node.className,this.originalContent=this.node.innerHTML}return __extends(e,t),e.pluginsRegistry={},e.register=function(){var t,e,n,r,o;for(e=1<=arguments.length?__slice.call(arguments,0):[],o=[],n=0,r=e.length;r>n;n++)t=e[n],this.pluginsRegistry[t.pluginName]=t,o.push(t.extendEditor(this));return o},e.prototype.activate=function(t){var n;return this.node.setAttribute("contenteditable",!0),this.plugins=function(){var t,r,o,i;for(o=this.opts.plugins,i=[],t=0,r=o.length;r>t;t++)n=o[t],i.push(new e.pluginsRegistry[n](this));return i}.call(this),this.initEvents(),null!=t?t(this):void 0},e.prototype.deactivate=function(t){return this.node.setAttribute("contenteditable",!1),null!=t?t(this):void 0},e.prototype.revert=function(){return this.node.innerHTML=this.originalContent},e.prototype.exec=function(){var t,e;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],t.length>0?document.execCommand.apply(document,[e,!1].concat(__slice.call(t))):document.execCommand(e,!1,this.getSelection()),this.checkSelection()},e.prototype.getSelection=function(){return rangy.getSelection()},e.prototype.initEvents=function(){var t=this;return this.node.addEventListener("keydown",function(e){return t.checkSelection(),t.trigger("keydown",e)}),this.node.addEventListener("keyup",function(){return t.checkSelection()}),this.node.addEventListener("mousedown",function(){return t.checkSelection()}),this.node.addEventListener("mouseup",function(){return t.checkSelection()})},e.prototype.checkSelection=function(){var t,e,n;return n=this.getSelection(),e=null,t=[],n.rangeCount&&(e=n.getRangeAt(0),e.collapsed?(e.startContainer||e.endContainer)&&(t=[e.startContainer||e.endContainer]):t=e.getNodes(),t=Utils.uniqueNodes(Utils.flatten(Utils.parentNodes(this.node,t)))),this.trigger("selection:change",n,e,t,n.toHtml())},e}(Events);