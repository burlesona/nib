(function(){var t;t="undefined"!=typeof exports&&null!==exports?exports:this,t.Nib={Plugins:{}}}).call(this),function(){var t=[].slice;Nib.Events=function(){function e(){this.handlers={}}return e.prototype.on=function(t,e){return null==this.handlers[t]&&(this.handlers[t]=[]),this.handlers[t].push(e),this},e.prototype.off=function(t,e){return null!=this.handlers[t]&&(this.handlers[t]=this.handlers[t].filter(function(t){return t===!e})),this},e.prototype.trigger=function(){var e,n,o,i,r,s;if(o=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this.handlers[o]){for(s=this.handlers[o],i=0,r=s.length;r>i;i++)n=s[i],n.apply(null,t.call(e).concat([this]));return this}},e.prototype.clear=function(){return this.handlers={}},e}()}.call(this),function(){Nib.SelectionHandler=function(){function t(){this.selection=rangy.getSelection(),this.baseNode=this.selection.nativeSelection.baseNode,this.baseOffset=this.selection.nativeSelection.baseOffset,this.extentNode=this.selection.nativeSelection.extentNode,this.extentOffset=this.selection.nativeSelection.extentOffset,this.backwards=this.selection.isBackwards()}return t.prototype.restoreSelection=function(){var t,e;return e=rangy.createRange(),e.setStart(this.baseNode,this.baseOffset),this.selection.removeAllRanges(),this.backwards?(e.setEnd(this.baseNode,this.baseOffset),t=rangy.createRange(),t.setStart(this.extentNode,this.extentOffset),t.setEnd(this.extentNode,this.extentOffset),this.selection.addRange(e),this.selection.addRange(t,!0),t.detach()):(e.setEnd(this.extentNode,this.extentOffset),this.selection.setSingleRange(e)),e.detach()},t}()}.call(this),function(){Nib.Utils={capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},parentNodes:function(t,e){var n,o,i,r,s;if(e instanceof Array){for(s=[],i=0,r=e.length;r>i;i++)n=e[i],s.push(this.parentNodes(t,n));return s}for(o=[];e&&e!==t;)o.push(e),e=e.parentNode;return o},flatten:function(t){return 0===t.length?[]:t.reduce(function(t,e){return t.concat(e)})},uniqueNodes:function(t){var e,n,o,i,r,s;for(n=[],o=0,r=t.length;r>o;o++)e=t[o],e._visited||n.push(e),e._visited=!0;for(i=0,s=n.length;s>i;i++)e=n[i],e._visited=!1;return n},domNodes:function(t){return t.filter(function(t){return 1===t.nodeType})}}}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function o(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},o=[].slice;t=Nib.Utils,Nib.Editor=function(e){function i(t){null==t&&(t={}),this.opts=t,this.plugins=t.plugins||[],this.node=t.node,this.originalClass=this.node.className,this.originalContent=this.node.innerHTML,i.__super__.constructor.call(this,t)}return n(i,e),i.prototype.activate=function(){var e,n,o,i,r;for(this.node.setAttribute("contenteditable",!0),r=this.plugins,o=0,i=r.length;i>o;o++)n=r[o],e=t.capitalize(n),this[n]=new Nib.Plugins[e](this);return this.initDOMEvents(),this.trigger("editor:on")},i.prototype.deactivate=function(){var t,e,n,o;for(this.node.setAttribute("contenteditable",!1),o=this.plugins,e=0,n=o.length;n>e;e++)t=o[e],this[t].deactivate();return this.deactivateDOMEvents(),this.trigger("editor:off"),this.clear()},i.prototype.hasChanged=function(){return this.node.innerHTML!==this.originalContent},i.prototype.revert=function(){return this.node.innerHTML=this.originalContent},i.prototype.exec=function(){var t,e;return e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],t.length>0?document.execCommand.apply(document,[e,!1].concat(o.call(t))):document.execCommand(e,!1,this.getSelection()),this.checkSelection()},i.prototype.initDOMEvents=function(){return this.node.addEventListener("keydown",this.onKeydown.bind(this)),this.node.addEventListener("keyup",this.onKeyup.bind(this)),this.node.addEventListener("mousedown",this.onMousedown.bind(this)),this.node.addEventListener("mouseup",this.onMouseup.bind(this))},i.prototype.deactivateDOMEvents=function(){return this.node.removeEventListener("keydown",this.onKeydown),this.node.removeEventListener("keyup",this.onKeyup),this.node.removeEventListener("mousedown",this.onMousedown),this.node.removeEventListener("mouseup",this.onMouseup)},i.prototype.onKeydown=function(t){return this.checkSelection(),this.trigger("keydown",t)},i.prototype.onKeyup=function(){return this.checkSelection()},i.prototype.onMousedown=function(){return this.checkSelection()},i.prototype.onMouseup=function(){return this.checkSelection()},i.prototype.getSelection=function(){return rangy.getSelection()},i.prototype.getSelectedNodes=function(){var e,n,o;return o=this.getSelection(),e=[],o.rangeCount&&(n=o.getRangeAt(0),n.collapsed?(n.startContainer||n.endContainer)&&(e=[n.startContainer||n.endContainer]):e=n.getNodes(),e=t.uniqueNodes(t.flatten(t.parentNodes(this.node,e))),n.detach()),o.detach(),e},i.prototype.checkSelection=function(){var t,e,n,o,i,r,s;for(o=this.getSelection(),o.rangeCount&&(n=o.getRangeAt(0)),e={selection:o,range:n,nodes:this.getSelectedNodes(),states:[]},s=this.plugins,i=0,r=s.length;r>i;i++)t=s[i],this[t].checkSelection(e)&&e.states.push(t);return this.trigger("report",e),this.detach(n)},i.prototype.detach=function(){var t,e,n,i,r;for(t=1<=arguments.length?o.call(arguments,0):[],r=[],n=0,i=t.length;i>n;n++)e=t[n],e&&r.push(e.detach());return r},i.prototype.saveSelection=function(){return new Nib.SelectionHandler},i.prototype.restoreSelection=function(t){return t.restoreSelection(),this.checkSelection()},i.prototype.selectNode=function(t,e){var n;return null==e&&(e=null),e=e||this.getSelection(),n=rangy.createRange(),n.selectNode(t),e.setSingleRange(n),this.checkSelection()},i.prototype.wrap=function(t){var e,n,o,i;return i=this.getSelection(),o=i.getRangeAt(0),n=document.createElement(t),o.canSurroundContents()&&o.surroundContents(n),e=rangy.createRange(),e.selectNodeContents(n),i.setSingleRange(e),this.checkSelection(),this.detach(o),n},i.prototype.lookForTags=function(t,e){var n,o,i,r;for(r=[],o=0,i=e.length;i>o;o++)n=e[o],1===n.nodeType&&n.tagName.toLowerCase()===t&&r.push(n);return r},i.prototype.lookForTag=function(t,e){var n,o,i;for(o=0,i=e.length;i>o;o++)if(n=e[o],1===n.nodeType&&n.tagName.toLowerCase()===t)return n},i.prototype.wrapped=function(t){return this.lookForTag(t,this.getSelectedNodes())},i.prototype.unwrap=function(t){var e,n,o,i,r,s;for(o=this.saveSelection(),s=this.lookForTags(t,this.getSelectedNodes()),i=0,r=s.length;r>i;i++){for(n=s[i];e=n.firstChild;)n.parentNode.insertBefore(e,n);n.remove()}return this.restoreSelection(o),this.checkSelection()},i}(Nib.Events)}.call(this);